(this.webpackJsonp=this.webpackJsonp||[]).push([["zerint-barzahlen-viacash-shopware6"],{"/sn7":function(e,n,t){"use strict";t.r(n);const s=Shopware.Classes.ApiService;var i=class extends s{constructor(e,n,t="viacash"){super(e,n,t)}refund(e={orderId:null,versionId:null,refundAmount:null}){const n=this.getBasicHeaders();return this.httpClient.post(`_action/${this.getApiBasePath()}/refund`,JSON.stringify(e),{headers:n}).then(e=>s.handleResponse(e))}};const r=Shopware.Classes.ApiService;var a=class extends r{constructor(e,n,t="viacash"){super(e,n,t)}resend(e={orderId:null,versionId:null}){const n=this.getBasicHeaders();return this.httpClient.post(`_action/${this.getApiBasePath()}/resend`,JSON.stringify(e),{headers:n}).then(e=>r.handleResponse(e))}};const o=Shopware.Classes.ApiService;var d=class extends o{constructor(e,n,t="viacash"){super(e,n,t)}ping(){this.getBasicHeaders();return this.httpClient.get(`_action/${this.getApiBasePath()}/ping`).then(e=>o.handleResponse(e))}};const{Application:c}=Shopware;c.addServiceProvider("ViacashRefundService",e=>{const n=c.getContainer("init");return new i(n.httpClient,e.loginService)}),c.addServiceProvider("ViacashResendService",e=>{const n=c.getContainer("init");return new a(n.httpClient,e.loginService)}),c.addServiceProvider("ViacashPingService",e=>{const n=c.getContainer("init");return new d(n.httpClient,e.loginService)});var u=t("9C+Q"),l=t.n(u);const{Component:h,Service:m}=Shopware;h.override("sw-order-state-history-card",{template:l.a,props:{orderId:{type:String,required:!0}},inject:["ViacashRefundService","ViacashResendService"],data(){let e=0,n="";return this.order.customFields&&"custom_viacash_refundable_amount"in this.order.customFields&&(e=parseInt(this.order.customFields.custom_viacash_refundable_amount)),this.order.customFields&&"custom_viacash_checkout_token"in this.order.customFields&&(n=Boolean(this.order.customFields.custom_viacash_checkout_token)),{isLoading:!1,refundValue:e,maxRefundValue:e,isViacash:n,askForRefundConfirmation:0}},methods:{onConfirmRefund(){this.ViacashRefundService.refund({orderId:this.order.id,versionId:this.order.versionId,refundAmount:this.askForRefundConfirmation}).then(document.location.reload()),this.askForRefundConfirmation=0,document.getElementById("sw-field--refundValue").readOnly=!1},onAbortRefund(){this.askForRefundConfirmation=0,document.getElementById("sw-field--refundValue").readOnly=!1},onInitiateRefund(e,n){e<=0?document.getElementById("refundErrors").innerHTML='<span style="background:#FFB9AD; color:red; padding: 8px">'+this.$tc("refundamount.mustbepositive")+"</span>":e>this.order.customFields.custom_viacash_refundable_amount?document.getElementById("refundErrors").innerHTML='<span style="background:#FFB9AD; color:red; padding: 8px">'+this.$tc("refundamount.mustbesmallerthan")+parseInt(this.order.customFields.custom_viacash_refundable_amount)+"</span>":(document.getElementById("refundErrors").innerText="",document.getElementById("sw-field--refundValue").readOnly=!0,this.askForRefundConfirmation=e)},onResend(e){this.order.customFields.custom_viacash_slip_id&&this.ViacashResendService.resend({orderId:this.order.id,versionId:this.order.versionId})}}});var f=t("0AQ4"),p=t("TyN7");const{Module:v}=Shopware;v.register("viacash",{type:"plugin",name:"Viacash",title:"viacash.general.mainMenuItemGeneral",description:"viacash.general.descriptionTextModule",version:"1.0.0",targetVersion:"1.0.0",color:"#333",icon:"default-action-settings",snippets:{"de-DE":f,"en-GB":p}});var g=t("9qZ9"),b=t.n(g);const{Component:S,Mixin:R}=Shopware;S.register("api-test-button",{template:b.a,props:["label"],inject:["ViacashPingService"],mixins:[R.getByName("notification")],data:()=>({isLoading:!1,isSaveSuccessful:!1}),computed:{pluginConfig(){return this.$parent.$parent.$parent.actualConfigData.null}},methods:{saveFinish(){this.isSaveSuccessful=!1},ping(){this.isLoading=!0,this.ViacashPingService.ping().then(e=>{e.success?(this.isSaveSuccessful=!0,this.createNotificationSuccess({title:this.$tc("api-test-button.title"),message:this.$tc("api-test-button.success")+e.successful_ids.toString()})):this.createNotificationError({title:this.$tc("api-test-button.title"),message:this.$tc("api-test-button.error")}),this.isLoading=!1})}}})},"0AQ4":function(e){e.exports=JSON.parse('{"viacash":{"resendButton":"Zahlschein erneut senden","confirmResend":"Zahlschein erneut an den Kunden senden?","confirmButton":"Erstatten","confirmRefund":"Betrag an Kunden erstatten?","title":"Barzahlen"},"api-test-button":{"title":"API Test","success":"Verbindung wurde erfolgreich getestet mit folgenden Divisionen: ","error":"Verbindung konnte nicht hergestellt werden. Bitte prüfen Sie die Zugangsdaten."},"refundamount":{"mustbepositive":"Der zu erstattende Betrag muss größer Null sein.","mustbesmallerthan":"Der höchstmögliche zu erstattende Betrag ist "}}')},"9C+Q":function(e,n){e.exports='{% block sw_order_state_history_card_transaction %}\n    {% parent %}\n<div v-if="isViacash" class="sw-order-state-card-entry">\n    <div>\n        <h2>{{ $tc(\'viacash.title\') }}</h2>\n    </div>\n    <div v-if="maxRefundValue > 0">\n        <div id="refundErrors" style="margin-bottom: 12px;"></div>\n        <sw-number-field numberType="float"\n                         size="medium"\n                         max="maxRefundValue"\n                         v-model="refundValue">\n        </sw-number-field>\n\n        <sw-button v-if="!askForRefundConfirmation"\n                   @click="onInitiateRefund(refundValue, $tc(\'viacash.confirmRefund\') )"\n                   size="small">\n                {{ $tc(\'viacash.confirmButton\') }}\n            </sw-button>\n\n        <sw-button v-if="askForRefundConfirmation >0 " @click="onAbortRefund()"\n                   size="small"> {{ $tc(\'global.default.cancel\') }}\n            </sw-button>\n\n        <sw-button v-if="askForRefundConfirmation >0 " @click="onConfirmRefund()" variant="danger"\n                   size="small">\n                                       {{ $tc(\'viacash.confirmButton\') }}\n            </sw-button>\n\n    </div>\n    <div v-else>\n        <sw-button @click="onResend($tc(\'viacash.confirmResend\') )" variant="small" size="small">\n                {{ $tc(\'viacash.resendButton\') }}\n            </sw-button>\n    </div>\n</div>\n{% endblock %}\n'},"9qZ9":function(e,n){e.exports='<div>\n    <sw-button-process\n        :isLoading="isLoading"\n        :processSuccess="isSaveSuccessful"\n        @process-finish="saveFinish"\n        @click="ping"\n    >Test {{ label }}</sw-button-process>\n</div>\n'},TyN7:function(e){e.exports=JSON.parse('{"viacash":{"resendButton":"Resend payment slip","confirmResend":"Resend payment slip to customer?","confirmButton":"Refund","confirmRefund":"Confirm refund?","title":"Viacash"},"api-test-button":{"title":"API Test","success":"Connection was successfully tested for the following divisions: ","error":"Connection could not be established. Please check the access data."},"refundamount":{"mustbepositive":"The amount to be refunded must be positive and non-zero.","mustbesmallerthan":"The amount to be refunded must be less than or equal "}}')}},[["/sn7","runtime"]]]);
